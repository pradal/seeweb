{% extends "templates/project/layout_content.jinja2" %}

{% block project_css -%}

<link href="{{ request.static_url('seeweb:project/content/workflow/static/style.css') }}" rel="stylesheet">

{%- endblock %}

{% block project_content_body -%}

<div id="workflow_canvas">
    {{ svg_repr|safe }}
    <div id="canvas_controls">
        <a id="up" href="#"></a>
        <a id="down" href="#"></a>
    </div>
</div>

<div class="well debug">
    {{ cnt_item.definition }}
</div>

{%- endblock %}

{% block project_js -%}

<script>
    var viewbox;
    var scaling_range = [-3, -2, -1, 0, 1, 2, 3].map(function(i) {return Math.pow(Math.SQRT2, i);});
    var scaling_ind = 3;
    var scaling;

    window.onload = function() {
        viewbox = {{ svg_viewbox }};

        $.attrHooks['viewbox'] = {
            set: function(elem, value, name) {
                elem.setAttributeNS(null, 'viewBox', value + '');
                return value;
            }
        };

        $("#canvas_controls #up").click(function (e) {
            scaling_ind = Math.min(scaling_range.length - 1, scaling_ind + 1);
            scaling = scaling_range[scaling_ind];
            var newbox = viewbox.map(function(v) {return scaling * v;});
            $("#workflow_canvas #repr").attr('viewbox', newbox.join(', '));
            e.preventDefault();
        });

        $("#canvas_controls #down").click(function (e) {
            scaling_ind = Math.max(0, scaling_ind - 1);
            scaling = scaling_range[scaling_ind];
            var newbox = viewbox.map(function(v) {return scaling * v;});
            $("#workflow_canvas #repr").attr('viewbox', newbox.join(', '));
            e.preventDefault();
        });
    }
</script>

{%- endblock %}
